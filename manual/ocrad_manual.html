<html lang="en">
<head>
<title>GNU Ocrad Manual</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15">
<meta name="description" content="GNU Ocrad Manual">
<meta name="generator" content="makeinfo 4.13+">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">GNU Ocrad Manual</h2>

<p>This manual is for GNU Ocrad (version 0.26, 24 March 2017).

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>:                 Purpose and features of GNU Ocrad
<li><a accesskey="2" href="#Character-sets">Character sets</a>:               Input charsets and output formats
<li><a accesskey="3" href="#Invoking-ocrad">Invoking ocrad</a>:               Command line interface
<li><a accesskey="4" href="#Filters">Filters</a>:                      Postprocessing the produced text
<li><a accesskey="5" href="#Library-version">Library version</a>:              Checking library version
<li><a accesskey="6" href="#Library-functions">Library functions</a>:            Descriptions of the library functions
<li><a accesskey="7" href="#Library-error-codes">Library error codes</a>:          Meaning of codes returned by functions
<li><a accesskey="8" href="#Image-format-conversion">Image format conversion</a>:      How to convert other formats to pnm
<li><a accesskey="9" href="#Algorithm">Algorithm</a>:                    How ocrad does its job
<li><a href="#OCR-results-file">OCR results file</a>:             Description of the ORF file format
<li><a href="#Problems">Problems</a>:                     Reporting bugs
<li><a href="#Concept-index">Concept index</a>:                Index of concepts
</ul>

   <pre class="sp">

</pre>
Copyright &copy; 2003-2017 Antonio Diaz Diaz.

   <p>This manual is free documentation: you have unlimited permission
to copy, distribute and modify it.

<div class="node">
<a name="Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Character-sets">Character sets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Introduction</h2>

<p><a name="index-introduction-1"></a>
GNU Ocrad is an OCR (Optical Character Recognition) program and library
based on a feature extraction method. It reads images in pbm (bitmap),
pgm (greyscale) or ppm (color) formats and produces text in byte&nbsp;(8-bit)<!-- /@w --> or UTF-8 formats. The pbm, pgm and ppm formats are collectively
known as pnm.

   <p>Ocrad includes a layout analyser able to separate the columns or blocks
of text normally found on printed pages.

   <p>For best results the characters should be at least 20 pixels high. If
they are smaller, try the '<samp><span class="samp">--scale</span></samp>' option. Scanning the image at
300 dpi usually produces a character size good enough for ocrad.

<div class="node">
<a name="Character-sets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Invoking-ocrad">Invoking ocrad</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Character sets</h2>

<p><a name="index-input-charsets-2"></a><a name="index-output-format-3"></a>
The character set internally used by ocrad is ISO 10646, also known as
UCS (Universal Character Set), which can represent over two thousand
million characters (2^31).

   <p>As it is unpractical to try to recognize one among so many different
characters, you can tell ocrad what character sets to recognize. You do
this with the '<samp><span class="samp">--charset</span></samp>' option.

   <p>If the input page contains characters from only one character set, say
'<samp><span class="samp">ISO-8859-15</span></samp>'<!-- /@w -->, you can use the default '<samp><span class="samp">byte</span></samp>' output
format. But in a page with '<samp><span class="samp">ISO-8859-9</span></samp>'<!-- /@w --> and
'<samp><span class="samp">ISO-8859-15</span></samp>'<!-- /@w --> characters, you can't tell if a code of 0xFD
represents a 'latin small letter i dotless' or a 'latin small letter y
with acute'. You should use '<samp><span class="samp">--format=utf8</span></samp>'<!-- /@w --> instead.<br>
Of course, you may request UTF-8 output in any case.

   <pre class="sp">

</pre>
NOTE: 10^9 is a thousand millions, a billion is a million millions
(million^2), a trillion is a million million millions (million^3), and
so on. Please, don't "embrace and extend" the meaning of prefixes,
making communication among all people difficult. Thanks.

<div class="node">
<a name="Invoking-ocrad"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Filters">Filters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Character-sets">Character sets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Invoking ocrad</h2>

<p><a name="index-invoking-4"></a><a name="index-options-5"></a><a name="index-usage-6"></a><a name="index-version-7"></a>
The format for running ocrad is:

<pre class="example">     ocrad [<var>options</var>] [<var>files</var>]
</pre>
   <p class="noindent">'<samp><span class="samp">-</span></samp>' used as a <var>file</var> argument means standard input. It can be
mixed with other <var>files</var> and is read just once, the first time it
appears in the command line. Ocrad can read concatenated files from
standard input.

   <p>Ocrad supports the following options:

     <dl>
<dt><code>-h</code><dt><code>--help</code><dd>Print an informative help message describing the options and exit. 
'<samp><span class="samp">ocrad&nbsp;--verbose&nbsp;--help</span></samp>'<!-- /@w --> describes also hidden options.

     <br><dt><code>-V</code><dt><code>--version</code><dd>Print the version number of ocrad on the standard output and exit.

     <br><dt><code>-a</code><dt><code>--append</code><dd>Append generated text to the output file instead of overwriting it.

     <br><dt><code>-c </code><var>name</var><dt><code>--charset=</code><var>name</var><dd>Enable recognition of the characters belonging to the given character set. 
You can repeat this option multiple times with different names for
processing a page with characters from different character sets.<br>
If no charset is specified, '<samp><span class="samp">iso-8859-15</span></samp>'<!-- /@w --> (latin9) is assumed.<br>
Try '<samp><span class="samp">--charset=help</span></samp>'<!-- /@w --> for a list of valid charset names.

     <p><a name="g_t_002d_002dfilter"></a><br><dt><code>-e </code><var>name</var><dt><code>--filter=</code><var>name</var><dd>Pass the output text through the given built-in postprocessing filter
(see <a href="#Filters">Filters</a>). Several filters can be applied in sequence using as
many '<samp><span class="samp">--filter</span></samp>' and '<samp><span class="samp">--user-filter</span></samp>' options as needed. The
filters are applied in the order they appear on the command line.<br>
Try '<samp><span class="samp">--filter=help</span></samp>'<!-- /@w --> for a list of valid filter names.

     <p><a name="g_t_002d_002duser_002dfilter"></a><br><dt><code>-E </code><var>file</var><dt><code>--user-filter=</code><var>file</var><dd>Pass the output text through the postprocessing filter defined in
<var>file</var>. See the chapter '<samp><span class="samp">Filters</span></samp>' (see <a href="#Filters">Filters</a>) for a
description of the format of <var>file</var>. Several filters can be applied
in sequence using as many '<samp><span class="samp">--filter</span></samp>' and '<samp><span class="samp">--user-filter</span></samp>'
options as needed. The filters are applied in the order they appear on
the command line.

     <br><dt><code>-f</code><dt><code>--force</code><dd>Force overwrite of output files.

     <br><dt><code>-F </code><var>name</var><dt><code>--format=</code><var>name</var><dd>Select the output format. The valid names are '<samp><span class="samp">byte</span></samp>' and '<samp><span class="samp">utf8</span></samp>'.<br>
If no output format is specified, '<samp><span class="samp">byte</span></samp>' (8 bit) is assumed.

     <br><dt><code>-i</code><dt><code>--invert</code><dd>Invert image levels (white on black).

     <br><dt><code>-l</code><dt><code>--layout</code><dd>Enable page layout analysis. Ocrad is able to separate blocks of text of
arbitrary shape as long as they are clearly delimited by white space.

     <br><dt><code>-o </code><var>file</var><dt><code>--output=</code><var>file</var><dd>Place the output into <var>file</var> instead of into the standard output.

     <br><dt><code>-q</code><dt><code>--quiet</code><dd>Quiet operation.

     <br><dt><code>-s </code><var>value</var><dt><code>--scale=</code><var>value</var><dd>Scale up the input image by <var>value</var> before layout analysis and
recognition. If <var>value</var> is negative, the input image is scaled down
by <var>-value</var>.

     <br><dt><code>-t </code><var>name</var><dt><code>--transform=</code><var>name</var><dd>Perform given transformation (rotation or mirroring) on the input image
before scaling, layout analysis and recognition. Rotations are made
counter-clockwise.<br>
Try '<samp><span class="samp">--transform=help</span></samp>'<!-- /@w --> for a list of valid transformation names.

     <br><dt><code>-T </code><var>value</var><dt><code>--threshold=</code><var>value</var><dd>Set binarization threshold for pgm or ppm files or for '<samp><span class="samp">--scale</span></samp>'
option (only for scaled down images). <var>value</var> should be a rational
number between 0 and 1, and may be given as a percentage (50%), a
fraction (1/2), or a decimal value (0.5). Image values greater than
threshold are converted to white. The default value is 0.5.

     <br><dt><code>-u </code><var>left</var><code>,</code><var>top</var><code>,</code><var>width</var><code>,</code><var>height</var><dt><code>--cut=</code><var>left</var><code>,</code><var>top</var><code>,</code><var>width</var><code>,</code><var>height</var><dd>Cut the input image by the rectangle defined by <var>left</var>, <var>top</var>,
<var>width</var> and <var>height</var>. Values may be relative to the image size
(-1.0&nbsp;&lt;=&nbsp;value&nbsp;&lt;=&nbsp;+1.0)<!-- /@w -->, or absolute (abs(&nbsp;value&nbsp;)&nbsp;&gt;&nbsp;1)<!-- /@w -->. 
Negative values of <var>left</var>, <var>top</var> are relative to the
right-bottom corner of the image. Values of <var>width</var> and <var>height</var>
must be positive. Absolute and relative values can be mixed. For example
'<samp><span class="samp">ocrad&nbsp;--cut&nbsp;700,960,1,1</span></samp>'<!-- /@w --> will extract from '<samp><span class="samp">700,960</span></samp>' to
the right-bottom corner of the image.<br>
The cutting is performed before any other transformation (rotation or
mirroring) on the input image, and before scaling, layout analysis and
recognition.

     <br><dt><code>-v</code><dt><code>--verbose</code><dd>Verbose mode.

     <br><dt><code>-x </code><var>file</var><dt><code>--export=</code><var>file</var><dd>Write (export) OCR results file to <var>file</var> (see <a href="#OCR-results-file">OCR results file</a>). 
'<samp><span class="samp">-x&nbsp;-</span></samp>'<!-- /@w --> writes to stdout, overriding text output except if
output has been also redirected with the '<samp><span class="samp">-o</span></samp>' option.

   </dl>

   <p>Exit status: 0 for a normal exit, 1 for environmental problems (file not
found, invalid flags, I/O errors, etc), 2 to indicate a corrupt or
invalid input file, 3 for an internal consistency error (eg, bug) which
caused ocrad to panic.

<div class="node">
<a name="Filters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Library-version">Library version</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Invoking-ocrad">Invoking ocrad</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Postprocessing the produced text</h2>

<p><a name="index-filters-8"></a>
Filters replace some characters in the text output with different
characters and remove some other characters from the output. For
example, when recognizing a text that is known to contain just numbers,
any character recognized as a '<samp><span class="samp">Z</span></samp>' will probably be a '<samp><span class="samp">2</span></samp>'.

   <p>Filters don't enable the recognition of characters, just filter them
from the output. Use '<samp><span class="samp">--charset</span></samp>' to enable the recognition of a
character set different from the default ISO-8859-15.

   <p>Ocrad provides both built-in filters and user-defined filters.

<h3 class="section">4.1 User-defined filters</h3>

<p>The format of a user-defined filter file (see <a href="#g_t_002d_002duser_002dfilter">--user-filter</a>) is very
simple. Each line contains either a character conversion or a word that
specifies the default behaviour for unlisted characters.

   <p>A character conversion is a comma-separated list of quoted characters
('c'), character sets ([0-9A-Z]), character codes (U0063), or character
ranges (U0000 - UFFFF), and an optional conversion (an equal sign (=)
followed by a quoted character or a character code). The characters in
the list are converted to the character in the conversion. If no
conversion is specified, the character is left unmodified (converted to
itself).

   <p>The default behaviour is to discard unlisted characters, i.e. those
characters not appearing in the file, either by themselves or included
in a set or range. If a line containing just the word '<samp><span class="samp">leave</span></samp>' is
found in the file, unlisted characters are left unmodified. If the word
is '<samp><span class="samp">mark</span></samp>', unlisted characters are marked as unrecognized.

   <p>The destination character of a conversion is considered as listed by
default. Every character may be listed more than once, even as part of
different conversions. The last conversion affecting a given character
is the one that is performed.

   <p>Character sets and quoted characters may contain escape sequences.

   <p>The character '<samp><span class="samp">#</span></samp>' at begin of line or after whitespace starts a
comment that extends to the end of the line.

   <p>Ranges of characters may be specified in character sets by writing the
starting and ending characters with a '<samp><span class="samp">-</span></samp>' between them. Thus,
'<samp><span class="samp">[A-Z]</span></samp>' matches any ASCII uppercase letter. '<samp><span class="samp">-</span></samp>' may be
specified by placing it first or last. '<samp><span class="samp">]</span></samp>' may be specified by
placing it first. If the first character after the left bracket is
'<samp><span class="samp">^</span></samp>', it indicates a "complemented set", which matches any character
except the ones between the brackets.

   <p>Literals (quoted characters and character sets) are decoded as
ISO-8859-15. Character codes are decoded as UCS2. Thus, a '<samp><span class="samp">latin
capital letter y with diaeresis</span></samp>' is specified in a set as '<samp><span class="samp">[\xBE]</span></samp>',
but its code is '<samp><span class="samp">U0178</span></samp>'.

   <p>Spaces and control characters are unaffected by filters, except that
leadind, trailing, and duplicate spaces produced by the removal of other
characters will be themselves removed.

<p class="noindent">Here is an example user-defined filter file equivalent to the built-in
filter '<samp><span class="samp">numbers</span></samp>':

<pre class="example">     leave                      # remove this line to get '<samp><span class="samp">numbers_only</span></samp>'
     'D', 'O', 'Q', 'o' = '0'
     'I', 'L', 'l', '|' = '1'
     'Z', 'z'           = '2'
                          '3'
     'A', 'q'           = '4'
     'S', 's'           = '5'
     'G', 'b', U00F3    = '6'   # latin small letter o with acute
     'J', 'T'           = '7'
     '&amp;', 'B'           = '8'
     'g'                = '9'
</pre>
   <h3 class="section">4.2 Built-in filters</h3>

<p>Ocrad provides the following built-in filters (see <a href="#g_t_002d_002dfilter">--filter</a>):

     <dl>
<dt><code>--filter=letters</code><dd>Forces every character that resembles a letter to be recognized as a
letter. Other characters will be output without change.

     <br><dt><code>--filter=letters_only</code><dd>Same as '<samp><span class="samp">--filter=letters</span></samp>', but other characters will be discarded.

     <br><dt><code>--filter=numbers</code><dd>Forces every character that resembles a number to be recognized as a
number. Other characters will be output without change.

     <br><dt><code>--filter=numbers_only</code><dd>Same as '<samp><span class="samp">--filter=numbers</span></samp>' but other characters will be discarded.

     <br><dt><code>--filter=same_height</code><dd>Discards any character (or noise) whose height differs in more than 10
percent from the median height of the characters in the line.

     <br><dt><code>--filter=text_block</code><dd>Discards any character (or noise) outside of a rectangular block of text
lines.

     <br><dt><code>--filter=upper_num</code><dd>Forces every character that resembles a uppercase letter or a number to
be recognized as such. Other characters will be output without change.

     <br><dt><code>--filter=upper_num_mark</code><dd>Same as '<samp><span class="samp">--filter=upper_num</span></samp>', but other characters will be marked
as unrecognized.

     <br><dt><code>--filter=upper_num_only</code><dd>Same as '<samp><span class="samp">--filter=upper_num</span></samp>', but other characters will be
discarded.

   </dl>

<div class="node">
<a name="Library-version"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Library-functions">Library functions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Filters">Filters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Library version</h2>

<p><a name="index-library-version-9"></a>

<div class="defun">
-- Function: const char * <b>OCRAD_version</b> (<var> void </var>)<var><a name="index-OCRAD_005fversion-10"></a></var><br>
<blockquote><p>Returns the library version as a string. 
</p></blockquote></div>

<div class="defun">
-- Constant: const char * <b>OCRAD_version_string</b><var><a name="index-OCRAD_005fversion_005fstring-11"></a></var><br>
<blockquote><p>This constant is defined in the header file '<samp><span class="samp">ocradlib.h</span></samp>'. 
</p></blockquote></div>

   <p>The application should compare OCRAD_version and OCRAD_version_string
for consistency. If the first character differs, the library code
actually used may be incompatible with the '<samp><span class="samp">ocradlib.h</span></samp>' header file
used by the application.

<pre class="example">     if( OCRAD_version()[0] != OCRAD_version_string[0] )
       error( "bad library version." );
</pre>
   <div class="node">
<a name="Library-functions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Library-error-codes">Library error codes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Library-version">Library version</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Library functions</h2>

<p><a name="index-library-functions-12"></a>
These are the OCRAD library functions. In case of error, all of them
return -1 or a null pointer, except '<samp><span class="samp">OCRAD_open</span></samp>' whose return value
must be verified by calling '<samp><span class="samp">OCRAD_get_errno</span></samp>' before using it.

<div class="defun">
-- Function: struct OCRAD_Descriptor * <b>OCRAD_open</b> (<var> void </var>)<var><a name="index-OCRAD_005fopen-13"></a></var><br>
<blockquote><p>Initializes the internal library state and returns a pointer that can
only be used as the <var>ocrdes</var> argument for the other OCRAD functions,
or a null pointer if the descriptor could not be allocated.

        <p>The returned pointer must be verified by calling '<samp><span class="samp">OCRAD_get_errno</span></samp>'
before using it. If '<samp><span class="samp">OCRAD_get_errno</span></samp>' does not return
'<samp><span class="samp">OCRAD_ok</span></samp>', the returned pointer must not be used and should be
freed with '<samp><span class="samp">OCRAD_close</span></samp>' to avoid memory leaks. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_close</b> (<var> struct OCRAD_Descriptor * const ocrdes </var>)<var><a name="index-OCRAD_005fclose-14"></a></var><br>
<blockquote><p>Frees all dynamically allocated data structures for this descriptor. 
After a call to '<samp><span class="samp">OCRAD_close</span></samp>', <var>ocrdes</var> can no more be used as
an argument to any OCRAD function. 
</p></blockquote></div>

<div class="defun">
-- Function: enum OCRAD_Errno <b>OCRAD_get_errno</b> (<var> struct OCRAD_Descriptor * const ocrdes </var>)<var><a name="index-OCRAD_005fget_005ferrno-15"></a></var><br>
<blockquote><p>Returns the current error code for <var>ocrdes</var> (see <a href="#Library-error-codes">Library error codes</a>). 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_set_image</b> (<var> struct OCRAD_Descriptor * const ocrdes, const struct OCRAD_Pixmap * const image, const bool invert </var>)<var><a name="index-OCRAD_005fset_005fimage-16"></a></var><br>
<blockquote><p>Loads <var>image</var> into the internal buffer. If <var>invert</var> is true,
image levels are inverted (white on black). Loading a new image deletes
any previous text results. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_set_image_from_file</b> (<var> struct OCRAD_Descriptor * const ocrdes, const char * const filename, const bool invert </var>)<var><a name="index-OCRAD_005fset_005fimage_005ffrom_005ffile-17"></a></var><br>
<blockquote><p>Loads a image from the file <var>filename</var> into the internal buffer. If
<var>invert</var> is true, image levels are inverted (white on black). 
Loading a new image deletes any previous text results. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_set_utf8_format</b> (<var> struct OCRAD_Descriptor * const ocrdes, const bool utf8 </var>)<var><a name="index-OCRAD_005fset_005futf8_005fformat-18"></a></var><br>
<blockquote><p>Set the output format to '<samp><span class="samp">byte</span></samp>' (if <var>utf8</var>=false) or to
'<samp><span class="samp">utf8</span></samp>'. By default ocrad produces '<samp><span class="samp">byte</span></samp>' (8 bit) output. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_set_threshold</b> (<var> struct OCRAD_Descriptor * const ocrdes, const int threshold </var>)<var><a name="index-OCRAD_005fset_005fthreshold-19"></a></var><br>
<blockquote><p>Set binarization threshold for greymap or RGB images. <var>threshold</var>
values between 0 and 255 set a fixed threshold. A value of -1 sets an
automatic threshold. Pixel values greater than the resulting threshold
are converted to white. The default threshold value if this function is
not called is 127. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_scale</b> (<var> struct OCRAD_Descriptor * const ocrdes, const int value </var>)<var><a name="index-OCRAD_005fscale-20"></a></var><br>
<blockquote><p>Scale up the image in the internal buffer by <var>value</var>. If <var>value</var>
is negative, the image is scaled down by <var>-value</var>. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_recognize</b> (<var> struct OCRAD_Descriptor * const ocrdes, const bool layout </var>)<var><a name="index-OCRAD_005frecognize-21"></a></var><br>
<blockquote><p>Recognize the image loaded in the internal buffer and produce text
results which can be later retrieved with the '<samp><span class="samp">OCRAD_result</span></samp>'
functions. The same image can be recognized as many times as desired,
for example setting a new threshold each time for 3D greymap
recognition. Every time this function is called, the produced text
results replace any previous ones. If <var>layout</var> is true, page layout
analysis is enabled, probably producing more than one text block. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_result_blocks</b> (<var> struct OCRAD_Descriptor * const ocrdes </var>)<var><a name="index-OCRAD_005fresult_005fblocks-22"></a></var><br>
<blockquote><p>Returns the number of text blocks found in the image, or 0 if no text
was found. The returned value is usually 1, but can be larger if layout
analysis was requested. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_result_lines</b> (<var> struct OCRAD_Descriptor * const ocrdes, const int blocknum </var>)<var><a name="index-OCRAD_005fresult_005flines-23"></a></var><br>
<blockquote><p>Returns the number of text lines contained in the given text block. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_result_chars_total</b> (<var> struct OCRAD_Descriptor * const ocrdes </var>)<var><a name="index-OCRAD_005fresult_005fchars_005ftotal-24"></a></var><br>
<blockquote><p>Returns the total number of text characters contained in the recognized
image. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_result_chars_block</b> (<var> struct OCRAD_Descriptor * const ocrdes, const int blocknum </var>)<var><a name="index-OCRAD_005fresult_005fchars_005fblock-25"></a></var><br>
<blockquote><p>Returns the number of text characters contained in the given text block. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_result_chars_line</b> (<var> struct OCRAD_Descriptor * const ocrdes, const int blocknum, const int linenum </var>)<var><a name="index-OCRAD_005fresult_005fchars_005fline-26"></a></var><br>
<blockquote><p>Returns the number of text characters contained in the given text line. 
</p></blockquote></div>

<div class="defun">
-- Function: const char * <b>OCRAD_result_line</b> (<var> struct OCRAD_Descriptor * const ocrdes, const int blocknum, const int linenum </var>)<var><a name="index-OCRAD_005fresult_005fline-27"></a></var><br>
<blockquote><p>Returns the line of text specified by <var>blocknum</var> and <var>linenum</var>. 
</p></blockquote></div>

<div class="defun">
-- Function: int <b>OCRAD_result_first_character</b> (<var> struct OCRAD_Descriptor * const ocrdes </var>)<var><a name="index-OCRAD_005fresult_005ffirst_005fcharacter-28"></a></var><br>
<blockquote><p>Returns the byte result for the first character in the image. Returns 0
if the image has no characters or if the first character could not be
recognized. This function is a convenient short cut to the result for
images containing a single character. 
</p></blockquote></div>

<div class="node">
<a name="Library-error-codes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Image-format-conversion">Image format conversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Library-functions">Library functions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 Library error codes</h2>

<p><a name="index-library-error-codes-29"></a>
Most library functions return -1 or a null pointer to indicate that they
have failed. But this return value only tells you that an error has
occurred. To find out what kind of error it was, you need to verify the
error code by calling '<samp><span class="samp">OCRAD_get_errno</span></samp>'.

   <p>Library functions don't change the value returned by
'<samp><span class="samp">OCRAD_get_errno</span></samp>' when they succeed; thus, the value returned by
'<samp><span class="samp">OCRAD_get_errno</span></samp>' after a successful call is not necessarily
OCRAD_ok, and you should not use '<samp><span class="samp">OCRAD_get_errno</span></samp>' to determine
whether a call failed. If the call failed, then you can examine
'<samp><span class="samp">OCRAD_get_errno</span></samp>'.

   <p>The error codes are defined in the header file '<samp><span class="samp">ocradlib.h</span></samp>'.

<div class="defun">
-- Constant: enum OCRAD_Errno <b>OCRAD_ok</b><var><a name="index-OCRAD_005fok-30"></a></var><br>
<blockquote><p>The value of this constant is 0 and is used to indicate that there is no
error. 
</p></blockquote></div>

<div class="defun">
-- Constant: enum OCRAD_Errno <b>OCRAD_bad_argument</b><var><a name="index-OCRAD_005fbad_005fargument-31"></a></var><br>
<blockquote><p>At least one of the arguments passed to the library function was
invalid. 
</p></blockquote></div>

<div class="defun">
-- Constant: enum OCRAD_Errno <b>OCRAD_mem_error</b><var><a name="index-OCRAD_005fmem_005ferror-32"></a></var><br>
<blockquote><p>No memory available. The system cannot allocate more virtual memory
because its capacity is full. 
</p></blockquote></div>

<div class="defun">
-- Constant: enum OCRAD_Errno <b>OCRAD_sequence_error</b><var><a name="index-OCRAD_005fsequence_005ferror-33"></a></var><br>
<blockquote><p>A library function was called in the wrong order. For example
'<samp><span class="samp">OCRAD_result_line</span></samp>' was called before '<samp><span class="samp">OCRAD_recognize</span></samp>'. 
</p></blockquote></div>

<div class="defun">
-- Constant: enum OCRAD_Errno <b>OCRAD_library_error</b><var><a name="index-OCRAD_005flibrary_005ferror-34"></a></var><br>
<blockquote><p>A bug was detected in the library. Please, report it (see <a href="#Problems">Problems</a>). 
</p></blockquote></div>

<div class="node">
<a name="Image-format-conversion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Algorithm">Algorithm</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Library-error-codes">Library error codes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 Image format conversion</h2>

<p><a name="index-image-format-conversion-35"></a>
There are a lot of image formats, but ocrad is able to decode only three
of them; pbm, pgm and ppm. In this chapter you will find command
examples and advice about how to convert image files to a format that
ocrad can manage.

     <dl>
<dt>'<samp><span class="samp">.png</span></samp>'<dd>Portable Network Graphics file. Use the command
<code>pngtopnm&nbsp;filename.png&nbsp;|&nbsp;ocrad</code><!-- /@w -->.<br>
In some cases, like the ocrad.png icon, you have to invert the image
with the '<samp><span class="samp">-i</span></samp>' option: <code>pngtopnm&nbsp;filename.png&nbsp;|&nbsp;ocrad&nbsp;-i</code><!-- /@w -->.

     <br><dt>'<samp><span class="samp">.ps</span></samp>'<dt>'<samp><span class="samp">.pdf</span></samp>'<dd>Postscript or Portable Document Format file. Use the command
<code>gs&nbsp;-sPAPERSIZE=a4&nbsp;-sDEVICE=pnmraw&nbsp;-r300&nbsp;-dNOPAUSE&nbsp;-dBATCH&nbsp;-sOutputFile=-&nbsp;-q&nbsp;filename.ps&nbsp;|&nbsp;ocrad</code><!-- /@w -->.<br>
You may also use the command
<code>pstopnm&nbsp;-stdout&nbsp;-dpi=300&nbsp;-pgm&nbsp;filename.ps&nbsp;|&nbsp;ocrad</code><!-- /@w -->,<br>
but it seems not to work with pdf files. Also old versions of
<code>pstopnm</code> don't recognize the '<samp><span class="samp">-dpi</span></samp>' option and produce an
image too small for OCR.

     <br><dt>'<samp><span class="samp">.tiff</span></samp>'<dd>TIFF file. Use the command<br>
<code>tifftopnm&nbsp;filename.tiff&nbsp;|&nbsp;ocrad</code><!-- /@w -->.

     <br><dt>'<samp><span class="samp">.jpg</span></samp>'<dd>JPEG file. Use the command
<code>djpeg&nbsp;-greyscale&nbsp;-pnm&nbsp;filename.jpg&nbsp;|&nbsp;ocrad</code><!-- /@w -->.<br>
JPEG is a lossy format and is in general not recommended for text images.

     <br><dt>'<samp><span class="samp">.pnm.gz</span></samp>'<dd>Pnm file compressed with gzip. Use the command
<code>gzip&nbsp;-cd&nbsp;filename.pnm.gz&nbsp;|&nbsp;ocrad</code><!-- /@w -->

     <br><dt>'<samp><span class="samp">.pnm.lz</span></samp>'<dd>Pnm file compressed with lzip. Use the command
<code>lzip&nbsp;-cd&nbsp;filename.pnm.lz&nbsp;|&nbsp;ocrad</code><!-- /@w -->

   </dl>

<div class="node">
<a name="Algorithm"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#OCR-results-file">OCR results file</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Image-format-conversion">Image format conversion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">9 Algorithm</h2>

<p><a name="index-algorithm-36"></a>
Ocrad is mainly a research project. Many of the algorithms ocrad uses
are ad hoc, and will change in successive releases as I myself gain
understanding about OCR issues.

   <p>The overall working of ocrad may be described as follows:<br>
1) Read the image.<br>
2) Optionally, perform some transformations (cut, rotate, scale, etc).<br>
3) Optionally, perform layout detection.<br>
4) Remove frames and pictures.<br>
5) Detect characters and group them in lines.<br>
6) Recognize characters (very ad hoc; one algorithm per character).<br>
7) Correct some ambiguities (transform l.OOO into 1.000, etc).<br>
8) Optionally, apply one or more filters to the text.<br>
9) Output text result.

   <pre class="sp">

</pre>
Ocrad recognizes characters by its shape, and the reason it is so fast
is that it does not compare the shape of every character against some
sort of database of shapes and then chooses the best match. Instead of
this, ocrad only compares the shape differences that are relevant to
choose between two character categories, mostly like a binary search.

   <p>As there is no such thing as a free lunch, this approach has some
drawbacks. It makes ocrad very sensitive to character defects, and makes
difficult to modify ocrad to recognize new characters.

<div class="node">
<a name="OCR-results-file"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Problems">Problems</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Algorithm">Algorithm</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">10 OCR results file</h2>

<p><a name="index-OCR-results-file-37"></a>
Calling ocrad with option '<samp><span class="samp">-x</span></samp>' produces an OCR results file (ORF),
that is, a parsable file containing the OCR results. The ORF format is
as follows:

     <ul>
<li>Any line beginning with '<samp><span class="samp">#</span></samp>' is a comment line. 
<li>The first non-comment line has the form
'<samp><span class="samp">source&nbsp;file&nbsp;</span><var>filename</var></samp>'<!-- /@w -->, where <var>filename</var> is the name
of the file being processed ('<samp><span class="samp">-</span></samp>' for standard input). This is the
only line guaranteed to exist for every input file read without errors. 
If the file, or any block or line, has no text, the corresponding part
in the ORF file will be missing. 
<li>The second non-comment line has the form
'<samp><span class="samp">total&nbsp;text&nbsp;blocks&nbsp;</span><var>n</var></samp>'<!-- /@w -->, where <var>n</var> is the total number
of text blocks in the source image. 
</ul>

<p class="noindent">For each text block in the source image, the following data follows:

     <ul>
<li>A line in the form '<samp><span class="samp">text&nbsp;block&nbsp;</span><var>i</var><span class="samp">&nbsp;</span><var>x&nbsp;y&nbsp;w&nbsp;h</var></samp>'<!-- /@w -->. Where
<var>i</var> is the block number and <var>x y w h</var> are the block position and
size as described below for character boxes. 
<li>A line in the form '<samp><span class="samp">lines </span><var>n</var></samp>'. Where <var>n</var> is the number of
lines in this block. 
</ul>

<p class="noindent">For each line in every text block, the following data follows:

     <ul>
<li>A line in the form '<samp><span class="samp">line </span><var>i</var><span class="samp"> chars </span><var>n</var><span class="samp"> height </span><var>h</var></samp>',
where <var>i</var> is the line number, <var>n</var> is the number of characters in
this line, and <var>h</var> is the mean height of the characters in this line
(in pixels). 
<li>N lines (one for every character) in the form
'<samp><var>x</var><span class="samp">&nbsp;</span><var>y</var><span class="samp">&nbsp;</span><var>w</var><span class="samp">&nbsp;</span><var>h</var><span class="samp">;&nbsp;</span><var>g</var><span class="samp">[,&nbsp;'</span><var>c</var><span class="samp">'</span><var>v</var><span class="samp">]...</span></samp>'<!-- /@w -->,
where:<br>
<var>x</var> is the left border (x-coordinate) of the char bounding box in the
source image (in pixels).<br>
<var>y</var> is the top border (y-coordinate).<br>
<var>w</var> is the width of the bounding box.<br>
<var>h</var> is the height of the bounding box.<br>
<var>g</var> is the number of different recognition guesses for this character.<br>
The result characters follow after the number of guesses in the form of
a comma-separated list of pairs. Every pair is formed by the actual
recognised char <var>c</var> enclosed in single quotes, followed by the
confidence value <var>v</var>, without space between them. The higher the
value of confidence, the more confident is the result. 
</ul>

   <p>Running <code>./ocrad -x test.orf testsuite/test.pbm</code> in the source
directory will give you an example ORF file.

<div class="node">
<a name="Problems"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Concept-index">Concept index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#OCR-results-file">OCR results file</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">11 Reporting bugs</h2>

<p><a name="index-bugs-38"></a><a name="index-getting-help-39"></a>
There are probably bugs in ocrad. There are certainly errors and
omissions in this manual. If you report them, they will get fixed. If
you don't, no one will ever know about them and they will remain unfixed
for all eternity, if not longer.

   <p>If you find a bug in GNU Ocrad, please send electronic mail to
<a href="mailto:bug-ocrad@gnu.org">bug-ocrad@gnu.org</a>. Include the version number, which you can
find by running <code>ocrad&nbsp;--version</code><!-- /@w -->.

<div class="node">
<a name="Concept-index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Problems">Problems</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="unnumbered">Concept index</h2>

<ul class="index-cp" compact>
<li><a href="#index-algorithm-36">algorithm</a>: <a href="#Algorithm">Algorithm</a></li>
<li><a href="#index-bugs-38">bugs</a>: <a href="#Problems">Problems</a></li>
<li><a href="#index-filters-8">filters</a>: <a href="#Filters">Filters</a></li>
<li><a href="#index-getting-help-39">getting help</a>: <a href="#Problems">Problems</a></li>
<li><a href="#index-image-format-conversion-35">image format conversion</a>: <a href="#Image-format-conversion">Image format conversion</a></li>
<li><a href="#index-input-charsets-2">input charsets</a>: <a href="#Character-sets">Character sets</a></li>
<li><a href="#index-introduction-1">introduction</a>: <a href="#Introduction">Introduction</a></li>
<li><a href="#index-invoking-4">invoking</a>: <a href="#Invoking-ocrad">Invoking ocrad</a></li>
<li><a href="#index-library-error-codes-29">library error codes</a>: <a href="#Library-error-codes">Library error codes</a></li>
<li><a href="#index-library-functions-12">library functions</a>: <a href="#Library-functions">Library functions</a></li>
<li><a href="#index-library-version-9">library version</a>: <a href="#Library-version">Library version</a></li>
<li><a href="#index-OCR-results-file-37">OCR results file</a>: <a href="#OCR-results-file">OCR results file</a></li>
<li><a href="#index-options-5">options</a>: <a href="#Invoking-ocrad">Invoking ocrad</a></li>
<li><a href="#index-output-format-3">output format</a>: <a href="#Character-sets">Character sets</a></li>
<li><a href="#index-usage-6">usage</a>: <a href="#Invoking-ocrad">Invoking ocrad</a></li>
<li><a href="#index-version-7">version</a>: <a href="#Invoking-ocrad">Invoking ocrad</a></li>
</ul></body></html>

<!--

Local Variables:
coding: iso-8859-15
End:

-->
